在C++中，`try`和`catch`是异常处理的基本构建块，它们提供了一种结构化的方式来处理程序运行时可能出现的错误和异常情况。异常处理允许程序在检测到问题时优雅地恢复，而不是让程序崩溃或产生不可预测的行为。

### 基本概念

- **异常（Exception）**：在程序执行期间发生的特殊情况，可能会导致程序的正常流程被中断。异常通常表示为错误或不寻常的条件，需要特殊处理。

- **抛出异常（Throwing an Exception）**：当检测到异常条件时，程序可以通过`throw`语句抛出一个异常。这意味着程序将停止当前的执行流程，并寻找相应的异常处理代码。

- **捕获异常（Catching an Exception）**：`catch`块用于捕获和处理`try`块中抛出的异常。每个`catch`块专门处理一种类型的异常。

### 使用`try`和`catch`

异常处理的基本语法如下：

```cpp
try {
    // 保护代码
    // 这里的代码可能会抛出异常
}
catch (异常类型1& 异常对象名) {
    // 处理异常类型1
}
catch (异常类型2& 异常对象名) {
    // 处理异常类型2
}
// 可以有更多的catch块来捕获不同类型的异常
```

### 示例

```cpp
#include <iostream>
using namespace std;

int main() {
    try {
        // 假设这里有一些可能抛出异常的代码
        throw "An error occurred"; // 抛出一个异常
    }
    catch (const char* msg) {
        // 捕获并处理异常
        cerr << "Error: " << msg << endl;
    }
    return 0;
}
```

在上面的示例中，`throw`语句抛出了一个字符串类型的异常。`catch`块捕获了这个异常，并通过标准错误流输出了一个错误消息。

如果try中的函数有自动抛出异常的功能则不需要throw语句，catch用于捕获try中抛出的异常，***对于不同的异常需要对应的catch来捕获***，如果抛出了一个异常，而程序中没有相应的 `catch` 块来捕获它，那么 `std::terminate()` 函数会被调用。这通常会导致程序非正常终止。

```cpp
#include <iostream>
#include <vector>
using namespace std;
int main()
{
    std::vector<int> data = { 1, 2, 4, 5, 5, 6 };

    // Set element 1
    data.at(1) = 88;

    // Read element 2
    std::cout << "Element at index 2 has value " << data.at(2) << '\n';

    std::cout << "data size = " << data.size() << '\n';

    try {
        // Set element 6
        data.at(6) = 666;//at会自动抛出异常不需要throw
    } catch (std::out_of_range const& exc) {//这个异常是std::out_of_range异常，显然捕获成功
        cerr << exc.what() << '\n';
    }
    /*
    没有捕获到对应的异常 调用`std::terminate()`函数，输出异常程序终止
    catch (const char* msg) {
        // 捕获并处理异常
        cerr << "Error: " << msg << endl;
    }
    */

    // Print final values
    std::cout << "data:";
    for (int elem : data)
        std::cout << " " << elem;
    std::cout << '\n';
}
```

### `std::cerr` 与 `std::cout` 的区别

虽然 `std::cout` 和 `std::cerr` 都可以用于输出文本信息，但它们的用途和行为有所不同：

- `std::cout` 用于程序的常规输出，比如结果数据或用户提示。
- `std::cerr` 专门用于输出错误消息和诊断信息。由于它是未缓冲的，这使得在程序出现问题时，相关的错误信息能够立即显示给用户，而不是在程序崩溃时丢失。

这种区分有助于在重定向输出时分离常规信息和错误信息。例如，在 Unix 和类 Unix 系统中，你可以使用命令行将 `std::cout` 的输出重定向到一个文件，同时仍然在终端上看到通过 `std::cerr` 输出的错误信息。

### 注意点

- 异常可以是预定义的类型（如`int`、`std::string`等）或任何用户自定义类型。
- 通常推荐抛出并捕获异常对象的引用，特别是自定义类型的异常，这样可以避免不必要的复制，并且可以捕获到派生类类型的异常。
- `catch(...)`可以捕获任何类型的异常，通常用于"最后的防线"，但使用时应谨慎，因为它会捕获所有异常，包括你可能想要特别处理的异常。

异常处理是C++中一个强大的功能，它提供了一种安全的机制来处理运行时错误，使得程序更加健壯和易于维护。